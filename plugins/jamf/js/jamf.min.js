(function(){window.JamfPlugin=function(){var b=this;this.commands={};this.dialog_confirm_command=null;this.dialog_send_command=null;this.jamf_id=-1;this.itemtype=null;this.items_id=-1;this.ajax_root="";this.init=function(d){if(d!==undefined&&d.commands!==undefined){b.commands=d.commands;b.jamf_id=d.jamf_id;b.itemtype=d.itemtype;b.items_id=d.items_id;b.ajax_root=d.ajax_root||CFG_GLPI.root_doc+"/"+GLPI_PLUGINS_PATH.jamf+"/ajax/"}};this.onMDMCommandButtonClick=function(e,d){d.preventDefault();if(b.commands[e]!==undefined){if(b.commands[e]["params"]!==undefined){a(e)}else{if(b.commands[e]["confirm"]!==undefined&&b.commands[e]["confirm"]===true){c(e)}else{b.sendMDMCommand(e)}}}};var a=function(d){$.ajax({method:"GET",url:(b.ajax_root+"getMDMCommandForm.php"),data:{command:d}}).done(function(e){if(e!==undefined&&e!==null){if(b.dialog_send_command!==undefined&&b.dialog_send_command!==null){b.dialog_send_command.remove()}b.dialog_send_command=$(e).appendTo("#page");b.dialog_send_command.dialog({autoOpen:false,modal:true,close:function(){b.dialog_send_command.remove()}});b.dialog_send_command.dialog({buttons:{Send:function(){if(b.commands[d]["confirm"]!==undefined&&b.commands[d]["confirm"]===true){c(d,b.dialog_send_command.serialize())}else{b.sendMDMCommand(d,b.dialog_send_command.serialize())}},Cancel:function(){$(this).dialog("close")}}});b.dialog_send_command.dialog("open")}})};var c=function(f,e){if(b.dialog_confirm_command===undefined||b.dialog_confirm_command===null){b.dialog_confirm_command=$("<div id='jamf-mdmcommand-confirm'></div>").appendTo("#page");$(document).ready(function(){$("#jamf-mdmcommand-confirm").dialog({autoOpen:false,modal:true,close:function(){b.dialog_confirm_command.remove()}})})}b.dialog_confirm_command.dialog({buttons:{Confirm:function(){b.sendMDMCommand(f,e)},Cancel:function(){$(this).dialog("close")}}});var d=_x("message","Are you sure you want to send the command: %s?","jamf").replace("%s",_x("mdm_command",b.commands[f].name,"jamf"));b.dialog_confirm_command.text(d);b.dialog_confirm_command.dialog("open")};this.sendMDMCommand=function(e,d){if(d===undefined){d=""}$.ajax({method:"POST",url:(b.ajax_root+"sendMDMCommand.php"),data:{command:e,fields:d,jamf_id:b.jamf_id,itemtype:b.itemtype,items_id:b.items_id}}).always(function(){location.reload()})}}})();